# Vertical example (stitching):
# Union the outputs of two upstream "source pipelines" and deduplicate.
#
# IMPORTANT:
# - YAML does not support branching ("run pipeline A then run pipeline B then union") in a single job today.
# - The supported pattern is: run pipelines separately (A + B) -> stitch their outputs here.

pipeline:
  # Load and union outputs from upstream pipelines (A + B).
  # Paths are resolved from environment variables at runtime.
  - stage: load_union
    args:
      - { format: "csv", path: "${OUTPUT_PATH_A}", options: { header: "true", inferSchema: "true" } }
      - { format: "csv", path: "${OUTPUT_PATH_B}", options: { header: "true", inferSchema: "true" } }

  # Set-union semantics for records (pick a stable key for your vertical).
  # If you do not have a stable entity id (ean/sku), use url-level dedup as a safe baseline.
  - stage: dedup
    args: [ "url" ]

  - stage: save_csv
    args: [ "${OUTPUT_PATH_STITCHED}", "overwrite" ]


